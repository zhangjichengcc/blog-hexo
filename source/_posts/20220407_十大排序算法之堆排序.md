---
title: åå¤§æ’åºç®—æ³•ä¹‹å †æ’åº
date: 2022-04-07 17:54:57
tags:
banner_img:
index_img:
categories:
---

å‰æ®µæ—¶é—´ç ”ç©¶æ’åºç®—æ³•æ—¶ï¼Œå‘ç°å †æ’åºæ™®ééƒ½æ˜¯å…ˆç”Ÿæˆä¸€æ¬¡å¤§é¡¶å †ï¼Œç„¶åå†å¾ªç¯ç”Ÿæˆå¤§é¡¶å †è¿›è¡Œå †é¡¶å°¾äº¤æ¢æ’åºï¼Œåˆšå¼€å§‹å¾ˆä¸ç†è§£ä¸ºä»€ä¹ˆä¸ç»Ÿä¸€æ”¾åœ¨å¾ªç¯ä¸­å¤„ç†ï¼Œè¦å•ç‹¬å…ˆç”Ÿæˆä¸€æ¬¡å¤§é¡¶å †ï¼Ÿåœ¨åé¢æ·±å…¥ç ”ç©¶äº†ç®—æ³•ä¹‹åæ‰æ˜ç™½å…¶ä¸­é“ç†ï¼Œ**åœ¨å¤§é¡¶å †çš„åŸºç¡€ä¸Šç”Ÿæˆå¤§é¡¶å †è¦æ¯”æ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆæ›´å¿«æ·** åœ¨è¿™é‡Œåšä¸€ä¸‹æ€»ç»“ã€‚

<!-- more -->

> å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚

## é¢„å¤‡çŸ¥è¯†

> å †æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨äºŒå‰æ ‘ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼›æˆ–è€…æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †ã€‚å¦‚ä¸‹å›¾ï¼š

![Heap](/images/posts/20211118_æ’åºç®—æ³•æ±‡æ€»/Heap.png)

åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹å †ä¸­çš„ç»“ç‚¹æŒ‰å±‚è¿›è¡Œç¼–å·ï¼Œå°†è¿™ç§é€»è¾‘ç»“æ„æ˜ å°„åˆ°æ•°ç»„ä¸­å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­

![Heap Array](/images/posts/20211118_æ’åºç®—æ³•æ±‡æ€»/Heap1.png)

``` bash
      0
    /   \
   1     2          # 1 = 2*0+1    2 = 2*0+2
 /  \   /  \        
3    4 5    6       # 3 = 2*1+1    4 = 2*1+2    5 = 2*2+1    6 = 2*2+2

# leftChildIdx = 2 * parentIdx + 1
# rightChildIdx = 2 * parentIdx + 2
```

> å·¦å³å¶å­èŠ‚ç‚¹

å‡è®¾å½“å‰èŠ‚ç‚¹ `index = i` , åˆ™:  

- å·¦å¶å­èŠ‚ç‚¹ `2 * index + 1`;

- å³å¶å­èŠ‚ç‚¹ `2 * index + 2`;  

> æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹

å‡è®¾å½“å‰å †é•¿åº¦ä¸ºnï¼Œåˆ™æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹æœ‰ä¸¤ç§æƒ…å†µï¼š

1. åªæœ‰å·¦å¶å­èŠ‚ç‚¹ï¼ˆæ­¤æ—¶åˆ—è¡¨é•¿åº¦ä¸ºå¶æ•°ï¼‰

    ``` bash
      lastNodeIdx = n-1 = 2 * lastUnLeftNodeIdx + 1;
                       
      lastUnLeftNodeIdx = (n - 2) / 2;
                        = n / 2 - 1;
    ```

2. åŒ…å«å·¦å³å¶å­èŠ‚ç‚¹ï¼ˆæ­¤æ—¶åˆ—è¡¨é•¿åº¦ä¸ºå¥‡æ•°ï¼‰

    ``` bash
      lastNodeIdx = n-1 = 2 * lastUnLeftNodeIdx + 2;

      lastUnLeftNodeIdx = (n - 3) / 2;
                        = (n - 1) / 2 - 1;
    ```

å…¶ä¸­ `(n - 1) / 2` å¯ä»¥é€šè¿‡ `Math.floor(n - 1)` æ›¿ä»£ï¼Œæ ¹æ®ä¸Šé¢å…¬å¼å¯ä»¥æ¨å¯¼å‡º

``` bash
  lastUnLeftNodeIdx = Math.floor(n / 2) - 1; 
```

> å¤§é¡¶å † & å°é¡¶å †

``` bash
#   å¤§é¡¶å †                å°é¡¶å †

      6                     0
    /   \                 /   \
   5     4               1     2
 /  \   /  \           /  \   /  \     
3    2 1    0         3    4 5    6
```

æˆ‘ä»¬ç”¨ç®€å•çš„å…¬å¼æ¥æè¿°ä¸€ä¸‹å †çš„å®šä¹‰å°±æ˜¯ï¼š

- å¤§é¡¶å †ï¼š`arr[i] >= arr[2i+1] && arr[i] >= arr[2i+2]`

- å°é¡¶å †ï¼š`arr[i] <= arr[2i+1] && arr[i] <= arr[2i+2]`

## æ’åºæ€æƒ³

![Heap Sort](/images/posts/20220407_å †æ’åº/HeapSort.gif)

1. æ„é€ å¤§é¡¶å †ï¼ˆä¸€èˆ¬å‡åºé‡‡ç”¨å¤§é¡¶å †ï¼Œé™åºé‡‡ç”¨å°é¡¶å †)ï¼›
2. äº¤æ¢å †é¡¶ä¸æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶æ•°ç»„æœ€å¤§å€¼ä¸ºæœ€åä¸€é¡¹ï¼›
3. å‰©ä½™æœªæ’åºæ•°ç»„é‡å¤æ­¥éª¤ 1ã€2 è‡³æ•´ä¸ªæ•°ç»„æœ‰åºï¼›

## ä»£ç å®ç°

å®ç°åŸç†ï¼š

![Heap Sort](/images/posts/20220407_å †æ’åº/heap-sort.gif)

1. æ„é€ åˆå§‹å †ã€‚ä»æœ€åä¸€ä¸ª **éå¶å­èŠ‚ç‚¹** å¼€å§‹ï¼Œä»å³è‡³å·¦ï¼Œä»ä¸‹åˆ°ä¸Šå¤„ç†ï¼Œå°†ç»™å®šæ— åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †ï¼ˆä¸€èˆ¬å‡åºé‡‡ç”¨å¤§é¡¶å †ï¼Œé™åºé‡‡ç”¨å°é¡¶å †)ã€‚
2. äº¤æ¢å †é¡¶ä¸æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°†æœ€å¤§å…ƒç´ æ²‰è‡³æ•°ç»„æœ«ç«¯
3. ä»å †é¡¶å¼€å§‹ï¼Œé‡æ–°æ„å»ºå¤§é¡¶å †ï¼ˆç¬¬ä¸€æ­¥å·²ç»æ„å»ºè¿‡å¤§é¡¶å †ï¼Œæ‰€ä»¥ï¼‰
4. é‡å¤æ­¥éª¤2ã€3ï¼Œè‡³åºåˆ—æœ‰åº

åŸºæœ¬å·¥å…·æ–¹æ³•ï¼šç”Ÿæˆå•ä½å¤§é¡¶å † heaping

å…³äºæ–¹æ³•çš„è¯´æ˜:

- ä»æ ¹å¼€å§‹ï¼Œä¿è¯å·¦å³èŠ‚ç‚¹å‡å°äºæ ¹ï¼Œå®ç°æœ€åŸºæœ¬çš„å¤§é¡¶å †
- å½“å…ƒç´ äº¤æ¢æ—¶ï¼Œå°†ä¼šå½±å“åˆ°å­èŠ‚ç‚¹æ‰€æ„æˆçš„å †ï¼Œæ‰€ä»¥äº¤æ¢çš„å­èŠ‚ç‚¹éœ€è¦è°ƒç”¨æ–¹æ³•æœ¬èº«ç”Ÿæˆæ–°çš„å¤§é¡¶å †
- å½“ä»¥å¶å­èŠ‚ç‚¹ä¸ºæ ¹é‡æ–°ç”Ÿæˆå¤§é¡¶å †çš„æ—¶å€™ï¼Œä¸ä¼šå› ä¸ºå¶å­èŠ‚ç‚¹çš„æ”¹å˜è€Œåè¿‡æ¥é‡æ–°ç”Ÿæˆä¸Šå±‚çš„å †ï¼Œ**æ‰€ä»¥è¦æƒ³ç”Ÿæˆå¤§é¡¶å †ï¼Œå°±éœ€è¦ä¿è¯å·¦å³å¶å­èŠ‚ç‚¹å¿…é¡»ä¸ºå¤§é¡¶å †ï¼**

ä¸Šé¢è§£é‡Šæœ‰ç‚¹å¤æ‚ï¼Œç›´æ¥ç”»å›¾æ¥è¯´æ˜:

``` bash
 æƒ…å†µ1: æ¯ä¸ªå¶å­èŠ‚ç‚¹æ‰€æ„æˆçš„å †å‡ä¸ºå¤§é¡¶å †ï¼Œåˆ™æˆåŠŸç”Ÿæˆå¤§é¡¶å †
       0                     6                     6 
     /   \                 /   \                 /   \
    5     6      ==>      5     0      ==>      5     4       
  /  \   /  \           /  \   /  \           /  \   /  \     
 3    2 1    4         3    2 1    4         3    2 1    0

 æƒ…å†µ2: æ¯ä¸ªå¶å­èŠ‚ç‚¹æ‰€æ„æˆçš„å †å¹¶éå¤§é¡¶å †ï¼Œåˆ™æ— æ³•ç”Ÿæˆå¤§é¡¶å †
       0                     2                     2 
     /   \                 /   \                 /   \
    1     2      ==>      1     0      ==>      4     6      
  /  \   /  \           /  \   /  \           /  \   /  \     
 3    4 5    6         3    4 5    6         3    1 5    0
```

``` js
/**
 * ç”Ÿæˆå•ä½å¤§é¡¶å †
 * @param arr éœ€è¦å¤„ç†çš„æ•°ç»„
 * @param i æŒ‡å®šå½“å‰å¤§é¡¶å †æ ¹èŠ‚ç‚¹çš„idx
 * @param len æŒ‡å®šéœ€è¦å¤„ç†çš„æ•°ç»„èŒƒå›´ï¼ˆé•¿åº¦ï¼‰
 */
function heaping(arr: number[], begin: number, end: number) {
  let largestIdx = begin;      // è®¾ç½®æœ€å¤§å€¼index, é»˜è®¤å½“å‰i
  const leftIdx = 2 * begin + 1, rightIdx = 2 * begin + 2;
  if (leftIdx <= end && arr[leftIdx] > arr[largestIdx]) largestIdx = leftIdx;
  if (rightIdx <= end && arr[rightIdx] > arr[largestIdx]) largestIdx = rightIdx;
  if (largestIdx !== begin) { // æœ€å¤§å€¼idxå‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¡¨ç¤ºå †ç»“æ„å˜åŒ–ï¼Œæ›´æ–°largestIdxå¹¶å›è°ƒéªŒè¯å †
    // å°†æœ€å¤§å€¼ç§»åˆ°å †é¡¶
    [arr[largestIdx], arr[begin]] = [arr[begin], arr[largestIdx]];
    // ç”±äºå½“å‰å †æ”¹å˜ï¼Œå°†å½±å“åˆ°å¯¹åº”å­å †ï¼Œ
    heaping(arr, largestIdx, end);
  }
}
```

---

### æ–¹æ³•ä¸€(bad): å°†æ„å»ºå¤§é¡¶å †æ”¾å…¥å¾ªç¯ä¸­å¤„ç†

``` js
// å¾ªç¯ç”Ÿæˆå¤§é¡¶å †ï¼Œæ¯æ¬¡å¾ªç¯å°†å †é¡¶ï¼ˆæœ€å¤§å€¼ï¼‰å’Œå †å°¾è¿›è¡Œäº¤æ¢
function heapSort(arr: number[]) {
  // ä» arr.length - 1 ï¼ˆæ•°ç»„æœ€åä¸€é¡¹ï¼‰å¼€å§‹ï¼Œè®°å½•å½“å‰æœªæ’åºçš„å…ƒç´ æœ€åä¸€é¡¹ä¸‹æ ‡
  for(let i = arr.length - 1; i >= 0; i--) {
    // æ„å»ºå¤§é¡¶å †ï¼Œä»æœ€åä¸€é¡¹éå¶å­èŠ‚ç‚¹å¼€å§‹è‡³æ ¹èŠ‚ç‚¹ï¼Œå¾ªç¯è°ƒç”¨heaping
    for (let j = Math.floor(arr.length/2) - 1; j >= 0; j--) {
      heaping(arr, j, i);
    }
    // äº¤æ¢æœ€å¤§å€¼ä½ç½®ï¼Œæ¯æ¬¡å¾ªç¯å°†æœ€åä¸€ä½ï¼ˆindex = iï¼‰ä¸å †é¡¶å…ƒç´ äº¤æ¢ä½ç½®ï¼Œæœ€å¤§å€¼å§‹ç»ˆæ’å…¥æœ€åï¼ˆindex = iï¼‰è‡³æ•°ç»„æœ‰åº
    [arr[0], arr[i]] = [arr[i], arr[0]];
  }
  return arr;
}
```

### æ–¹æ³•äºŒ(good)ï¼šå…ˆç”Ÿæˆå¤§é¡¶å †ï¼Œç„¶åæ¯æ¬¡å¾ªç¯å†æ¬¡æ„å»ºå¤§é¡¶å †

æ–¹æ³•ä¸€ä¸­ï¼Œæ„å»ºå¤§é¡¶å †çš„æ­¥éª¤å…¶å®ä¸éœ€è¦æ¯æ¬¡å¾ªç¯éƒ½**ä»æœ€åä¸€é¡¹éå¶å­èŠ‚ç‚¹å¼€å§‹é‡æ–°ç”Ÿæˆ**ï¼Œåªè¦å…ˆç”Ÿæˆä¸€æ¬¡å¤§é¡¶å †ï¼Œåç»­æ¯æ¬¡**ä»æ ¹èŠ‚ç‚¹ç”Ÿæˆ**å³å¯

``` js
// åˆ›å»ºå¤§é¡¶å †
function buildMaxHeap(arr: number[]) {
  const len = arr.length;
  // Math.floor(len / 2) - 1 ä¸ºå½“å‰å®Œå…¨äºŒå‰æ ‘çš„æœ€åä¸€é¡¹éå¶å­èŠ‚ç‚¹
  // ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä»å³å¾€å·¦ï¼Œè‡ªä¸‹è€Œä¸Šè°ƒç”¨heapingæ–¹æ³•ï¼Œã€è§ä¸Šé¢ğŸ‘†è§£é‡Šï¼Œä»å°¾éƒ¨ç”Ÿæˆå¤§é¡¶å †åˆ™ä¿è¯æ•´ä¸ªå †ä¸ºå¤§é¡¶å †ã€‘
  for (let i = Math.floor(len / 2) - 1; i > 0; i--) {
    heaping(arr, i, len - 1);
  }
}

// æ’åº
function heapSort(arr: number[]) {
  // é¦–å…ˆå»ºç«‹å¤§é¡¶å †ï¼Œè¿™æ ·ä¹‹åæ¯æ¬¡æ’åºåˆ™ä¸éœ€è¦é‡æ–°ä»æ•°ç»„å°¾éƒ¨å¼€å§‹æ„å»ºå¤§é¡¶å †
  buildMaxHeap(arr);
  for(let i = arr.length - 1; i > 0; i--) {
    // å°†æœ€å¤§å€¼äº¤æ¢è‡³æ•°ç»„å°¾éƒ¨
    [arr[0], arr[i]] = [arr[i], arr[0]];
    // æ„å»ºå¤§é¡¶å †ï¼Œæ­¤å¤„ç›´æ¥ä»æ ¹èŠ‚ç‚¹å¼€å§‹ç”Ÿæˆå¤§é¡¶å †å³å¯ï¼Œå› ä¸ºæ ¹çš„å·¦å³å­èŠ‚ç‚¹æ‰€æ„æˆçš„å †å‡ä¸ºå¤§é¡¶å †, ã€è§ä¸Šé¢ğŸ‘†è§£é‡Šã€‘
    heaping(arr, 0, i - 1);
  }
  return arr;
}

heapSort([2,9,3,1,4,5,6,7,8])

```

## å‚è€ƒæ–‡çŒ®

[å †æ’åº](https://blog.zhangjc.cn/2022/04/07/20220407_%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E4%B9%8B%E5%A0%86%E6%8E%92%E5%BA%8F/)
